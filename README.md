# Umbraco Rich Text

[![npm version][npm-version-src]][npm-version-href]
[![License][license-src]][license-href]

Takes the JSON rich text output from the [Umbraco Content Delivery API](https://docs.umbraco.com/umbraco-cms/reference/content-delivery-api) and renders
it with React.

> [!IMPORTANT]  
> You need to enable the `RichTextOutputAsJson` option in the Content Delivery API.
> See [Content Delivery API configuration](https://docs.umbraco.com/umbraco-cms/reference/content-delivery-api#additional-configuration) for details.

[![Open in StackBlitz](https://developer.stackblitz.com/img/open_in_stackblitz_small.svg)](https://stackblitz.com/github/charlie-tango/umbraco-rich-text/tree/main?file=examples/UmbracoRichText/src/RichText.tsx)

## Install

Install the `@charlietango/umbraco-rich-text` package with your package manager
of choice.

```sh
npm install @charlietango/umbraco-rich-text
```

## `<UmbracoRichText>`

### Props

- `element`: The rich text property from the Umbraco Content Delivery API.
- `renderBlock`: Render a specific block type.
- `renderNode`: Overwrite the default rendering of a node. Return `undefined` to
  render the default node. Return `null` to skip rendering the node.
- `htmlAttributes`: Default attributes to set on the defined HTML elements.
  These will be used, unless the element already has the attribute set. The only
  exception is the `className` attribute, which will be merged with the default
  value.
- `stripStyles`: Remove inline style attributes from HTML elements. Accepts:
  - `true`: Removes all inline styles from all HTML elements
  - An object with configuration options:
    - `tags`: Array of HTML tags from which to strip styles. If not provided,
      styles are stripped from all tags.
    - `except`: Array of HTML tags that should keep their styles, even if they
      are in the `tags` array.
  - Default is `false` (all inline styles are preserved).

When passing the `renderBlock` and `renderNode` props, consider making them
static functions (move them outside the consuming component) to avoid
unnecessary re-renders.

```tsx
import {
  UmbracoRichText,
  RenderBlockContext,
  RenderNodeContext,
} from "@charlietango/umbraco-rich-text";
import Image from "next/image";
import Link from "next/link";

function renderNode({ tag, children, attributes }: RenderNodeContext) {
  switch (tag) {
    case "a":
      return <Link {...attributes}>{children}</Link>;
    case "p":
      return (
        <p className="text-lg" {...attributes}>
          {children}
        </p>
      );
    default:
      // Return `undefined` to render the default HTML node
      return undefined;
  }
}

function renderBlock({ content }: RenderBlockContext) {
  switch (content?.contentType) {
    // Switch over your Umbraco document types that can be rendered in the Rich Text blocks
    case "imageBlock":
      return <Image {...content.properties} />;
    default:
      return null;
  }
}

function RichText({ data }) {
  return (
    <UmbracoRichText
      data={data.richText}
      renderNode={renderNode}
      renderBlock={renderBlock}
      htmlAttributes={{ p: { className: "mb-4" } }}
      stripStyles={{
        // Strip styles from all tags except the following:
        except: ["img"], // Keep styles on `img` tags
      }}
    />
  );
}
```

### Blocks

You can augment the `renderBlock` method with the generated OpenAPI types from
Umbraco Content Delivery API. That way you can correctly filter the blocks you
are rendering, based on the `contentType`, and get the associated `properties`.
Create `types/umbraco-rich-text.d.ts`, and augment the `UmbracoBlockItemModel`
interface with your applications definition for `ApiBlockItemModel`.

To generate the types, you'll want to use the
[Delivery Api Extensions](https://marketplace.umbraco.com/package/umbraco.community.deliveryapiextensions)
package, alongside a tool to generate the types from the OpenAPI schema, like
[openapi-typescript](https://openapi-ts.dev/).

**types/umbraco-rich-text.d.ts**

```ts
 // Import the `components` generated by OpenAPI TypeScript.
import { components } from "./umbraco-openapi";

// Define the intermediate interface
type ApiBlockItemModel = components["schemas"]["ApiBlockItemModel"];

declare module "@charlietango/umbraco-rich-text" {
  interface UmbracoBlockItemModel extends ApiBlockItemModel {}
}
```

## `richTextToPlainText`

A utility function to convert an Umbraco RichText element to plain text. This
can be useful for generating meta descriptions or other text-based properties.

### Parameters

- `data` (`RichTextElementModel`): The rich text element to be converted.
- `options` (`Options`, _optional_): An object to specify additional options.
  - `firstParagraph` (`boolean`, _optional_): If `true`, only the first
    paragraph with text content will be returned.
  - `maxLength` (`number`, _optional_): The maximum length of the returned text.
    If the text exceeds this length, it will be truncated to the nearest word
    and an ellipsis will be added.
  - `ignoreTags` (`Array<string>`, _optional_): An array of tags to be ignored
    during the conversion.

### Returns

- `string`: The plain text representation of the rich text element.

### Example

```ts
import { richTextToPlainText } from "@charlietango/umbraco-rich-text";

const plainText = richTextToPlainText(richTextData);

// Just the first paragraph
const firstParagraph = richTextToPlainText(richTextData, {
  firstParagraph: true,
});

// Just the first 100 characters, truncated at the nearest word with an ellipsis
const first100Characters = richTextToPlainText(richTextData, {
  maxLength: 100,
});

// Ignore certain tags, skipping their content
const ignoreTags = richTextToPlainText(richTextData, {
  ignoreTags: ["h1", "h2", "ol", "figure"],
});
```

<!-- Badges -->

[npm-version-src]:
  https://img.shields.io/npm/v/@charlietango/umbraco-rich-text?style=flat&colorA=080f12&colorB=1fa669
[npm-version-href]: https://npmjs.com/package/@charlietango/umbraco-rich-text
[license-src]:
  https://img.shields.io/github/license/charlie-tango/umbraco-rich-text.svg?style=flat&colorA=080f12&colorB=1fa669
[license-href]:
  https://github.com/charlie-tango/umbraco-rich-text/blob/main/LICENSE
